<!-- INCOMPLETE PROTOTYPE -Aly -->

<!DOCTYPE html>
<html>
  <head>
    <title>Page template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    <style type="text/css">
		/* svg */
		#jp-svg-audio {
		    margin: 11px 0 33px 0;
		    position: relative;
		}
		.jp-audio {
		    line-height: 44px;
		    background-color: #f1f1f1;
		    margin-bottom: 2px;
		}
        .svg-wrapper svg {
            margin: 0 auto;
            display: block;
            border: 2px solid #eee;
            width: 100%;
            height: 100%;
        }
        .svg-wrapper path {
            stroke: #333;
            stroke-width: 2;
            stroke-dasharray: 0;
            stroke-dashoffset: 0;
            fill: none;
        }
        
        /* jplayer */
        .nav-btn {
            display: inline-block;
            width: 88px;
            text-align: center;
            line-height: 44px;
            padding: 0 20px;
            font-weight: bold;
            background-color: #7598C9;
            color: #fff;
        }
        .nav-btn:hover {
            opacity: 0.7;
            color: #fff;
            text-decoration: none;
        }
        .current-cue {
            display: inline-block;
        }
        .time {
            display: inline-block;
            margin-right: 10px;
            border-right: 1px solid #fff;
            width: 120px;
            text-align: center;
        }
    </style>
  </head>
  <body>
    
    <div id="jp-svg-audio">
        <div id="pop-audio" class="jp-jplayer"></div>
        <div id="jp_container_1" class="jp-audio">
            <div class="jp-type-single">
                <div class="jp-gui jp-interface">
                    <div class="jp-controls">
<!--                        <div id="back-btn" class="nav-btn back-next" title="Back"><i class="icon-backward icon-white">back</i></div> -->
                        <a href="javascript:;" class="jp-play nav-btn" tabindex="1"><i class="icon-play"></i> Play</a>
                        <a href="javascript:;" class="jp-pause nav-btn" tabindex="1" style="display: none;"><i class="icon-pause icon-white"></i> Pause</a>
<!--                        <div id="next-btn" class="nav-btn back-next" title="Next"><i class="icon-forward icon-white">next</i></div> -->
                        <span class="time"></span>
                        <span class="current-cue"></span>
                    </div>
                </div>
                <div class="jp-no-solution">
                    <span>Update Required</span>
                    To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.
                </div>
            </div>
        </div><!-- /.jp-audio -->

        <div class="svg-wrapper">
            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 width="500px" height="100px" viewBox="0 0 500 100" enable-background="new 0 0 500 100" xml:space="preserve">
                 <g>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
                        M53.801,32.298c-4.822-3.047-14.162-3.77-14.744,4.404c-0.708,9.973,28.188,16.125,20.892,35.143
                        c-8.805,22.951-43.458-8.423,2.489-14.05c9.167-1.124,20.256,0,24.003-12.487c3.554-11.837-9.396-7.367-12.876-0.361
                        c-14.431,29.048,41.378,25.04,35.146-5.82c-14.271,0.165-18.118,24.267-2.226,25.323c9.624,0.641,17.494-38.226,40.472-16.611
                        c-7.529-13.175-34.326-2.443-24.438,11.413c16.603,23.264,22.419-35.055,23.381-40.642c-2.297,16.639-6.676,62.495,24.761,43.966"
                        />
                </g>
                <g>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
                        M205.72,30.822c0.423,8.335-5.079,23.225,0.814,29.901c5.321,6.029,14.954,5.251,18.309-1.217"
                        />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
                        M195.173,46.758c10.183,0.442,18.044-1.368,23.904-1.593"
                        />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
                        M242.372,41.977c-10.244-5.994-20.775,17.194-4.004,18.666c20.328,1.787,14.451-20.841-5.557-19.708"
                        />
                </g>
                <g>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
                        M291.773,39.232c-2.745-3.196-7.38-5.674-11.248,0.1c-3.591,5.363,16.494,20.732,15.73,30.051c-3.025,6.917-9.814,8.61-16.64,2.312
                        c-0.087-12.765,12.813-11.342,20.639-18.407c9.652-8.715,15.238-18.388,13.822-32.067c0.026,16.104,0.945,31.968,1.6,47.979
                        c-0.876-7.623,1.81-16.172,9.244-18.874c1.691,14.921,16.417,19.188,19.908,2.394c0.112,4.693,4.062,10.038,5.835,13.81
                        c7.502-4.319,11.156-13.949,20.547-12.55c-2.569,30.148,31.977,10.237,28.988-12.789c-1.811,16.807,16.531,49.096,33.402,26.727"
                        />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
                        M384.2,47.2c-0.503,1.224,32.958,4.631,41.362,4.9c2.246-0.115,1.739-0.156-1.522-0.119"
                        />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="
                        M347.548,20.109c-1.47,1.248-2.022,2.913-1.593,4.781"
                        />
                </g>
            </svg>
        </div><!-- /.svg-wrapper -->
    </div><!-- /.jp-svg-audio -->


    <div class="container">
        <div class="row">
            <div class="col-md-10">
                <h3>h3. Lorem ipsum dolor sit</h3> 
                <p>amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
            </div>
        </div><!-- /.row -->  
    </div><!-- /.container -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script type="text/javascript" src="js/libs/jquery.jplayer.js"></script>
	<script type="text/javascript" src="js/libs/popcorn.ie8.js"></script>
	<script type="text/javascript" src="js/libs/popcorn.js"></script>
	<script type="text/javascript" src="js/libs/popcorn.code.js"></script>

	<script type="text/javascript" language="javascript">
	$(document).ready(function() {
	    var $w = $(window);
        var $player = $('#pop-audio');

        var AUDIO_LENGTH = 42;

        var cue_points = [];
        var pop;

	    // svg vars
	    var path_groups;
	    var path_groups_count;
	    var paths;
	    var paths_count;
	    var paths_target;
	    var $svg = $('.svg-wrapper').find('svg');
	    var svg_orig_width = $svg.width();
	    var svg_orig_height = $svg.height();
	    var animation_durations = [];
	    var animation_speed = 75;

        // svg animation
	    function set_paths() {
	        for (var g = 0; g < path_groups_count; g++) {
	            var group_paths = path_groups[g].children;
	            var group_paths_count = group_paths.length;
	            var group_animation_durations = [];
	            
	            for (var i = 0; i < group_paths_count; i++) {
	                var this_path = group_paths[i];
	                var this_path_length = this_path.getTotalLength();
	                this_path.style.transition = this_path.style.WebkitTransition = 'none'; // reset existing transforms
                    this_path.style.strokeDasharray = this_path_length + ' ' + this_path_length;
                    this_path.style.strokeDashoffset = this_path_length;
                    group_animation_durations.push(this_path_length / animation_speed);
	            }
	            animation_durations.push(group_animation_durations);
	        }
	    }

	    function reset_paths(group_paths) {
	        var group_paths_count = group_paths.length();

            for (var i = 0; i < group_paths_count; i++) {
                var this_path = group_paths[i];
                this_path.style.transition = this_path.style.WebkitTransition = 'none'; // reset existing transforms
                this_path.style.strokeDashoffset = this_path.getTotalLength();
            }
	    }

	    function play_animation(id) {
	        console.log('animate segment ' + id);
	        var group = path_groups[id];
	        var group_paths = group.children;
	        var group_paths_count = group_paths.length;

            if (parseInt(group_paths[0].style.strokeDashoffset) == 0) {
                reset_paths(group_paths); 
            }
            var transition_offset = 0;
            for (var i = 0; i < group_paths_count; i++) {
                var this_path = group_paths[i];
                this_path.getBoundingClientRect();
                this_path.style.transition = this_path.style.WebkitTransition = 'stroke-dashoffset ' + animation_durations[id][i] + 's ease-in-out';
                this_path.style.transitionDelay = this_path.style.WebkitTransitionDelay = transition_offset + 's';
                this_path.style.strokeDashoffset = '0';
                transition_offset += animation_durations[id][i];
            }
        };

        // add popcorn events
        function set_cue_point(id) {
            var pop_increment = 15;
            var pop_offset = 1;
            var start_point = (pop_increment * id) + pop_offset;
            var end_point = (pop_increment * id) + pop_offset + pop_increment;
            cue_points.push(start_point);

            pop.code({
                start: start_point,
                end: end_point,
                onStart: function(options) {
                    play_animation(id);
                    var cue_text = 'Current cuepoint: ' + (id + 1) + ' (of ' + path_groups_count + ')';
                    if (id < (cue_points.length - 1)) {
                        cue_text += ' | Next cuepoint: ' + $.jPlayer.convertTime(cue_points[id + 1]);
                    }
                    $('.current-cue').text(cue_text);
                    return false;
                }
                /*,
                onEnd: function(options) {
                    if (id == (cue_points.length - 1)) {
                        $('.current-cue').text('All done.');
                        $player.jPlayer('pause');
                        $player.jPlayer("playHead", 0);
                    }
                }
                */
            });
        }


        /* ---------- */        
        /* INITIALIZE */
        function setup() {
            // svg vars
            path_groups = document.querySelectorAll('.svg-wrapper g');
            path_groups_count = path_groups.length;
            paths = document.querySelectorAll('.svg-wrapper path');
            paths_count = paths.length;
            set_paths();

            // init jplayer
            $player.jPlayer({
                ready: function () {
                    console.log('jplayer ready');
                    $(this).jPlayer('setMedia', {
                        mp3: 'media/planet-money-tshirt.mp3'
                    }).jPlayer('pause');
                },
                play: function() {
                    playing = true;
                    console.log('playing audio');
                },
                pause: function() {
                    playing = false;
                    console.log('paused audio');
                },
                timeupdate: function(e) {
                    var current_time = $.jPlayer.convertTime(e.jPlayer.status.currentTime);
                    var elapsed_time = $.jPlayer.convertTime(Math.ceil(AUDIO_LENGTH- e.jPlayer.status.currentTime));
                    var total_time = $.jPlayer.convertTime(Math.ceil(AUDIO_LENGTH));
                    $('.time').text(current_time + ' / ' + total_time);
                },
                ended: function () {
    //                $(this).jPlayer("pause", AUDIO_LENGTH - 1);
                    playing = false;
                },
                swfPath: "js/libs",
                supplied: "mp3"
            });
            
            // init popcorn
            pop = Popcorn('#jp_audio_0');
            for (var i = 0; i < path_groups_count; i++) {
                set_cue_point(i);
            }
        }
        setup();
    });
	</script>
	
  </body>
</html>